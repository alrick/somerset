'use strict';var CC=contentful.createClient({space:'uemu4ddo7lar',accessToken:'c04219e0ca55fb73faabf90ec9d6ba90f5e2fa60e9e33a6eacf2f6228cceed38'});
'use strict';var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if('value'in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var Pin=function(){function Pin(name,description,type,lat,lng,owner,width,height,ratio,iconUrl){_classCallCheck(this,Pin);this.name=name;this.description=description;this.type=type;this.lat=lat;this.lng=lng;this.owner=owner;this.width=width;this.height=height;this.ratio=ratio;this.iconUrl=iconUrl}_createClass(Pin,[{key:'buildMarker',value:function buildMarker(){var marker=L.marker([this.lat,this.lng],{icon:this._buildIcon()});var tooltip=L.tooltip({direction:'bottom',className:'tooltip'});marker.bindTooltip(tooltip).setTooltipContent(this.toString());return marker}},{key:'toString',value:function toString(){var name='<p><span class="name">'+this.name+'</span> - <span class="type">'+this.type+'</span></p>';var description=this.description!==undefined?'<p class="description">'+this.description+'</p>':'';return name+description}},{key:'_buildIcon',value:function _buildIcon(){var i='<img src="'+this.iconUrl+'" width="'+this.width*this.ratio+'" height="'+this.height*this.ratio+'">';var blason=this._hasOwner()?'<img src="'+this.owner.blason+'" width="'+30*this.ratio+'" style="position:absolute;top:2px;right:'+-21*this.ratio+'px;">':'';var vassal=this._isVassal()?'<img src="'+this.vassal+'" width="'+19*this.ratio+'" style="position:absolute;top:6px;right:'+-40*this.ratio+'px;">':'';return L.divIcon({html:i+blason+vassal,iconSize:[this.width*this.ratio,this.height*this.ratio],iconAnchor:[this.width*this.ratio/2,this.height*this.ratio],popupAnchor:[0,-(this.height*this.ratio)],className:'icon'})}},{key:'_hasOwner',value:function _hasOwner(){return this.hasOwnProperty('owner')&&this.owner!==undefined&&this.owner!==''}},{key:'_isVassal',value:function _isVassal(){return this.hasOwnProperty('vassal')&&this.vassal!==undefined&&this.vassal!==''}}]);return Pin}();var Fief=function(_Pin){_inherits(Fief,_Pin);function Fief(name,description,type,lat,lng,owner,width,height,ratio,iconUrl,soldats,garnison,chevaliers,vassal){_classCallCheck(this,Fief);var _this=_possibleConstructorReturn(this,(Fief.__proto__||Object.getPrototypeOf(Fief)).call(this,name,description,type,lat,lng,owner,width,height,ratio,iconUrl));_this.soldats=soldats;_this.garnison=garnison;_this.chevaliers=chevaliers;_this.vassal=vassal;return _this}_createClass(Fief,[{key:'toString',value:function toString(){var parent=_get(Fief.prototype.__proto__||Object.getPrototypeOf(Fief.prototype),'toString',this).call(this);var military='<table><tr><td><img src="img/soldats.png" width="30"></td><td><img src="img/garnison.png" width="30"></td><td><img src="img/chevaliers.png" width="30"></td></tr><tr><td>'+this.soldats+'</td><td>'+this.garnison+'</td><td>'+this.chevaliers+'</td></tr></table>';return parent+military}}]);return Fief}(Pin);var Owner=function Owner(name,blason){_classCallCheck(this,Owner);this.name=name;this.blason=blason};
'use strict';// vars
var map=void 0;var zoom6=L.layerGroup();var zoom7=L.layerGroup();var ratio7=1;var ratio6=0.65;var allowedContentType=['building','fief'];var mapAssetId='5IedQC7r2geCO2UOAoug2A';var vassalAssetId='75jLoeJo9UOKW84oYUs6kC';// init map
$('#map').height(window.innerHeight-20);map=L.map('map',{minZoom:6,maxZoom:7}).setView([18.15629,34.67285],6);// set background
CC.getAsset(mapAssetId).then(function(asset){L.imageOverlay('https:'+asset.fields.file.url,[[0,0],[42.28,55]]).addTo(map)});// map events
map.on('contextmenu',function(ev){window.prompt('Copy to clipboard: Ctrl+C, Enter',ev.latlng.lat.toFixed(3)+','+ev.latlng.lng.toFixed(3))});map.on('zoomstart',function(){map.removeLayer(zoom6);map.removeLayer(zoom7)});map.on('zoomend',function(){var zoom=map.getZoom();map.removeLayer(zoom6);map.removeLayer(zoom7);map.addLayer(window['zoom'+zoom])});// get assets and draw pins
CC.getAsset(vassalAssetId).then(function(asset){drawPins('https:'+asset.fields.file.url)});function drawPins(vassalImage){CC.getEntries().then(function(entries){// log the title for all the entries that have it
entries.items.forEach(function(entry){if(allowedContentType.indexOf(entry.sys.contentType.sys.id)>-1){var data=entry.fields;var name=data.name;var description=data.description;var lat=data.lat;var lng=data.lng;var owner=void 0;if(data.owner!==undefined){owner=new Owner(data.owner.fields.name,'https:'+data.owner.fields.blason.fields.file.url)}var pin7=void 0;var pin6=void 0;if(entry.sys.contentType.sys.id==='fief'){var type=data.fiefType.fields.name;var width=data.fiefType.fields.buildingType.fields.iconWidth;var height=data.fiefType.fields.buildingType.fields.iconHeight;var iconUrl='https:'+data.fiefType.fields.buildingType.fields.icon.fields.file.url;var soldats=data.fiefType.fields.soldats;var garnison=data.fiefType.fields.garnison;var chevaliers=data.fiefType.fields.chevaliers;var vassal=data.vassal?vassalImage:'';pin7=new Fief(name,description,type,lat,lng,owner,width,height,ratio7,iconUrl,soldats,garnison,chevaliers,vassal);pin6=new Fief(name,description,type,lat,lng,owner,width,height,ratio6,iconUrl,soldats,garnison,chevaliers,vassal)}else{var _type=data.buildingType.fields.name;var _width=data.buildingType.fields.iconWidth;var _height=data.buildingType.fields.iconHeight;var _iconUrl='https:'+data.buildingType.fields.icon.fields.file.url;pin7=new Pin(name,description,_type,lat,lng,owner,_width,_height,ratio7,_iconUrl);pin6=new Pin(name,description,_type,lat,lng,owner,_width,_height,ratio6,_iconUrl)}zoom7.addLayer(pin7.buildMarker());zoom6.addLayer(pin6.buildMarker())}});map.addLayer(zoom6)})}
